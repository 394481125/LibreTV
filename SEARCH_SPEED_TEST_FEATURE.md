# 搜索结果一键测速功能

## 功能概述

LibreTV 现已支持**搜索结果一键测速功能**，让用户在浏览搜索结果时，能够快速了解各资源的速度情况，从而选择最快的资源进行观看。

## 功能特性

### 1. **单个资源测速**
- 📍 位置：搜索结果卡片上的 **"🚀 测速"** 按钮
- 🎯 功能：快速测试单个搜索结果的资源速度
- ⚡ 特点：
  - 实时显示测速结果（毫秒级）
  - 彩色速度徽章显示（顶部右角）
  - 卡片边框变色提示速度等级
  - toast 提示显示测速结果

### 2. **批量测速**
搜索结果需要时可使用批量测速功能：
- 📍 位置：搜索结果区域顶部 **"⚡ 全部测速"** 按钮
- 🎯 功能：一键测速所有搜索结果
- ⚡ 特点：
  - 自动逐个测速（每个测速间隔500ms）
  - 显示测速进度 (X/Y)
  - 避免请求过快对服务器的压力

### 3. **资源速度等级指示**
搜索结果卡片会根据测速结果显示不同的速度指示：
- 🟢 **绿色/快速**：< 1500ms（推荐）
- 🟡 **黄色/中等**：1500ms ~ 3000ms
- 🔴 **红色/慢**：> 3000ms（不推荐）
- ❌ **灰色/失败**：测速失败或无法连接

### 4. **视觉反馈**
- **卡片边框**：根据速度显示不同颜色边框
  - 快速资源：绿色边框
  - 中等速度：黄色边框
  - 慢速资源：红色边框
- **速度徽章**：卡片右上角显示速度徽章
  - 格式：`[图标] [时间]ms`
  - 例如：`🟢 1234ms`
- **彩色文字**：卡片底部显示彩色速度提示文字

## 使用流程

### 单个资源测速
1. 在搜索结果中找到想测速的资源卡片
2. 点击卡片上的 **"🚀 测速"** 按钮
3. 等待 1-5 秒，查看结果
4. 卡片会显示速度徽章和边框颜色
5. toast 提示显示速度评级

### 批量测速所有资源
1. 搜索得到结果后
2. 点击搜索结果区域顶部的 **"⚡ 全部测速"** 按钮
3. 系统自动逐个测速，显示进度 (X/Y)
4. 完成后会显示成功提示
5. 所有卡片都会显示速度信息

### 选择最优资源
1. 查看各资源卡片的速度徽章和边框颜色
2. 优先选择绿色（快速）的资源
3. 然后选择黄色（中等）的资源
4. 避免选择红色（慢）的资源
5. 点击卡片进入详情页面进行播放

## 速度测试原理

速度测试通过以下方式评估资源速度：
1. **API 响应时间**：调用详情 API 获取视频信息的响应时间
2. **综合时间**：从发送请求到收到响应的总时间
3. **超时设置**：5 秒超时，防止测速过久

## 技术细节

### 新增函数

#### `testSearchResultSpeed(btn)`
单个搜索结果测速
- 参数：
  - `btn`：测速按钮 DOM 元素
- 功能：
  - 提取卡片的资源信息
  - 调用 API 进行速度测试
  - 更新卡片的速度显示
  - 显示测速结果 toast

#### `batchTestSearchResults()`
批量测速所有搜索结果
- 参数：无
- 功能：
  - 获取页面中所有测速按钮
  - 逐个调用 `testSearchResultSpeed()`
  - 显示测速进度
  - 显示完成提示

### 新增 CSS 类

| 类名 | 用途 |
|------|------|
| `.search-result-card` | 搜索结果卡片容器 |
| `.search-result-speed-badge` | 速度徽章显示 |
| `.search-result-speed-btn` | 测速按钮 |
| `.search-result-speed-text` | 速度文字显示 |
| `.search-result-speed-text.good` | 快速文字（绿色） |
| `.search-result-speed-text.medium` | 中等文字（黄色） |
| `.search-result-speed-text.poor` | 慢速文字（红色） |

## HTML 变更

### 搜索结果卡片
搜索结果卡片现包含：
- **测速按钮**：`<button class="search-result-speed-btn">`
- **速度徽章**：`<div class="search-result-speed-badge">`
- **速度文本**：`<span class="search-result-speed-text">`

### 搜索结果区域
新增 **"全部测速"** 按钮：
```html
<button id="batchTestSearchBtn" onclick="batchTestSearchResults()">⚡ 全部测速</button>
```

## 使用建议

1. **首次搜索**：可以先查看搜索结果，再根据需要进行单个或批量测速
2. **批量测速**：在有大量搜索结果时使用，快速了解所有资源的速度情况
3. **选择资源**：优先选择绿色（快速）的资源，以获得最佳的播放体验
4. **多选测速**：搜索结果相同时，可测速不同来源的资源，选择最快的

## 注意事项

- ⚠️ 测速需要网络连接，请确保网络正常
- ⚠️ 测速时间取决于资源的响应速度和您的网络状况
- ⚠️ 快速的资源不一定能顺利播放（可能存在其他问题）
- ⚠️ 测速结果仅供参考，实际播放体验还取决于视频源的稳定性

## 浏览器兼容性

- ✅ Chrome/Edge 90+
- ✅ Firefox 88+
- ✅ Safari 14+
- ✅ Mobile Safari (iOS 14+)
